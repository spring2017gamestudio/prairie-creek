<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-timer/iron-timer.html">

<link rel="import" href="../shared-styles/shared-styles.html">
<link rel="import" href="../view-behavior/view-behavior.html">

<dom-module id="timer-view">
    <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      .text{
        padding-top: 50px;
      }
      .center {
        width: 40%;
      }
      #countdown {
        margin: 15px 0px 15px 0px;
        @apply(--paper-font-display3);
      }
    </style>
    <container>
      <div class="text">
        [[prompt]]
        <div id="countdown">
          [[secondsRemaining]]
        </div>
        <iron-timer id="timer" start-time="30" current-time="{{secondsRemaining}}"></iron-timer>
      </div>
      <paper-button
        class="center"
        id="button"
        raised
        on-tap="_next"
        disabled$="[[!_hasNoSecondsRemaining(secondsRemaining)]]">
          Go to checklist
      </paper-button>
    </container>
    <template is="dom-if" if$="[[devMode]]">
      <div class="debugging">
        <paper-button raised on-tap="_next">Skip</paper-button>
      </div>
    </template>
    </template>
    <script>
        Polymer({
            is: 'timer-view',
            behaviors: [ViewBehavior],

            properties: {
                currentSite: Object,

                prompt: {
                    type: String,
                },

                secondsRemaining: {
                    type: Number
                },

                devMode: {
                    type: Boolean,
                    value: false
                }
            },

            observers: [
                '_startTimerOnPageEntry(routeData)',
                '_pauseTimer(secondsRemaining)'
            ],

            _startTimerOnPageEntry: function(routeData) {
                if (routeData.page == "timer") {
                    this.$.timer.reset();
                    this.$.timer.start();
                }
            },

            _next: function() {
                this.$.timer.currentTime = 0;
                this.$.timer.reset();
                this._goToPage('checklist');
            },

            _pauseTimer: function(secondsRemaining) {
                if (secondsRemaining <= 0) {
                    this.$.timer.pause();
                    this.$.timer.currentTime = 0;
                }
            },

            _hasNoSecondsRemaining: function(secondsRemaining) {
                return secondsRemaining == 0;
            }
        });
    </script>
</dom-module>
