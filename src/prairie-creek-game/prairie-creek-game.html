<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-styles/default-theme.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<link rel="import" href="../title-view/title-view.html">
<link rel="import" href="../map-data/map-data.html">

<dom-module id="prairie-creek-game">

  <template>
    <app-location route="{{route}}" use-hash-as-path></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}"></app-route>
    <map-data data="{{mapData}}"></map-data>

    <iron-pages selected="[[routeData.page]]" attr-for-selected="name">
      <title-view name="title" route-data="{{routeData}}"></title-view>
      <intro-view name="intro" route-data="{{routeData}}"></intro-view>
      <map-view name="map" locations="[[mapData]]" route-data="{{routeData}}"></map-view>
      <arrival-view name="arrival" route-data="{{routeData}}"></arrival-view>
      <timer-view name="timer" route-data="{{routeData}}"></timer-view>
      <checklist-view name="checklist" route-data="{{routeData}}"></checklist-view>
      <wudgie-view name="wudgie" route-data="{{routeData}}"></wudgie-view>
      <collection-view name="collection" route-data="{{routeData}}"></collection-view>
      <missing-view name="missing" route-data="{{routeData}}"></missing-view>
    </iron-pages>
  </template>

  <script>
      Polymer({
          is: 'prairie-creek-game',

          properties: {
              mapData: {
                type: Object
              },
              route: {
                type: Object,
              },
              routeData: {
                type: Object,
                notify: true,
              }
          },

          observers: [
            '_onRoutePathChanged(route.path)',
            '_pageChanged(routeData.page)'
          ],

          _onRoutePathChanged: function(path) {
            // If we do not have an initial URL, redirect to title.
            if (!path) {
              this.set('route.path', '/title');
            }
          },

          _pageChanged: function(page) {
            if (page) {
              var resolvedPageUrl = this.resolveUrl('../' + page + '-view/' + page + '-view.html');
              this.importHref(resolvedPageUrl, null, this._showPage404, true);
            }
          },

          _showPage404: function() {
              this.set('routeData.page', 'missing');
          },
      });
  </script>
</dom-module>
